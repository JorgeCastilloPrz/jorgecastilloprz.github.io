<!DOCTYPE html>
<html>
<head>
    
    <link rel="stylesheet" type="text/css" href="/assets/built/style.css" />

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>Contrasting text and icons over background</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Fira+Code:500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Work+Sans&display=swap" rel="stylesheet">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand&display=swap" rel="stylesheet">

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->

    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="You'll find all my tech posts here." />
    <link rel="shortcut icon" href="https://jorgecastilloprz.github.io/assets/images/favicon.png" type="image/png" />
    <link rel="canonical" href="https://jorgecastilloprz.github.io/contrasting-text-and-icons-over-background" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="üë®‚Äçüíª Jorge Castillo" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Contrasting text and icons over background" />
    <meta property="og:description" content="Detecting whether background is dark or light to pick the right foreground color for better contrast. Quite often we‚Äôve needed to display icons or texts on top of colored backgrounds or images and we‚Äôve fallen into contrasting problems. Let‚Äôs say we have a header like this one in our app." />
    <meta property="og:url" content="https://jorgecastilloprz.github.io/contrasting-text-and-icons-over-background" />
    <meta property="og:image" content="https://jorgecastilloprz.github.io/assets/images/painting3.jpg" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2019-11-24T16:36:00+00:00" />
    <meta property="article:modified_time" content="2019-11-24T16:36:00+00:00" />
    <meta property="article:tag" content="Android" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Contrasting text and icons over background" />
    <meta name="twitter:description" content="Detecting whether background is dark or light to pick the right foreground color for better contrast. Quite often we‚Äôve needed to display icons or texts on top of colored backgrounds or images and we‚Äôve fallen into contrasting problems. Let‚Äôs say we have a header like this one in our app." />
    <meta name="twitter:url" content="https://jorgecastilloprz.github.io/" />
    <meta name="twitter:image" content="https://jorgecastilloprz.github.io/assets/images/painting3.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="üë®‚Äçüíª Jorge Castillo" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Android" />
    <meta name="twitter:site" content="@jorgecastillopr" />
    <meta name="twitter:creator" content="@jorgecastillopr" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "üë®‚Äçüíª Jorge Castillo",
        "logo": "https://jorgecastilloprz.github.io/"
    },
    "url": "https://jorgecastilloprz.github.io/contrasting-text-and-icons-over-background",
    "image": {
        "@type": "ImageObject",
        "url": "https://jorgecastilloprz.github.io/assets/images/painting3.jpg",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://jorgecastilloprz.github.io/contrasting-text-and-icons-over-background"
    },
    "description": "Detecting whether background is dark or light to pick the right foreground color for better contrast. Quite often we‚Äôve needed to display icons or texts on top of colored backgrounds or images and we‚Äôve fallen into contrasting problems. Let‚Äôs say we have a header like this one in our app."
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="Contrasting text and icons over background" href="/feed.xml" />

    <style>
        .highlighter-rouge, .highlight, code {
            width: 100%;
        }
    </style>


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://jorgecastilloprz.github.io/">üë®‚Äçüíª Jorge Castillo</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-animations" role="menuitem" style="margin-left: 14px;"><a class="colorWhite" href="/course/">Course üé¨</a></li>
    <li class="nav-androidcourse" style="margin-left: 10px; margin-right: 10px;" role="menuitem"><a class="colorOnHighlight" href="/book/">Book üìñ Jetpack Compose internals üî•</a></li>
    <li class="nav-about" role="menuitem"><a class="menuLink" href="/about/">About</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
                <a class="social-link social-link-tw" href="https://twitter.com/jorgecastillopr" target="_blank" rel="noopener"><img width=26 src="../assets/images/twitter.svg"/></a>
            
            
                <a class="social-link social-link-tw" href="https://androiddev.social/@jorge" target="_blank" rel="noopener"><img width=26 src="../assets/images/mastodon.svg"/></a>
            
        </div>
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full post ">

            <header class="post-full-header">
              <section class="post-full-meta">
                  <time class="post-full-meta-date" datetime="24 November 2019">24 November 2019</time>
              </section>

              
                  
                      <span class="post-card-tags"><a style="color:white;" href='/tag/android/'>Android</a></span>
                  
                      <span class="post-card-tags"><a style="color:white;" href='/tag/kotlin/'>Kotlin</a></span>
                  
              

                <h1 class="post-full-title">Contrasting text and icons over background</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/assets/images/painting3.jpg)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p>Detecting whether background is dark or light to pick the right foreground color for better contrast.</p>

<p>Quite often we‚Äôve needed to display icons or texts on top of colored backgrounds or images and we‚Äôve fallen into contrasting problems. Let‚Äôs say we have a header like this one in our app.</p>

<p><img src="assets/images/contrasting_icon_pink_bg.png" width="350px" /></p>

<p>That looks fine. Since background color is dark enough, we can go ahead and show light icons and texts over it so there‚Äôs enough contrast. But what if we switched the background to be a very light color dynamically? (let‚Äôs say white). In that case we‚Äôd rather showing dark icons and texts instead.</p>

<p><img src="assets/images/contrasting_icon_white_bg.png" width="350px" /></p>

<p>So we need a way to calculate how ‚Äúdark‚Äù or ‚Äúlight‚Äù is a color at runtime. We can use <code class="language-plaintext highlighter-rouge">ColorUtils.calculateLuminance(colorInt)</code> for this. Let‚Äôs write a handy extension to improve semantics, so we can call it over any <code class="language-plaintext highlighter-rouge">ColorInt</code>.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fun</span> <span class="err">@</span><span class="nf">receiver</span><span class="p">:</span><span class="nc">ColorInt</span> <span class="nc">Int</span><span class="p">.</span><span class="nf">isDark</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">=</span>
    <span class="nc">ColorUtils</span><span class="p">.</span><span class="nf">calculateLuminance</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">&lt;</span> <span class="mf">0.5</span>
</code></pre></div></div>

<p>You can find <code class="language-plaintext highlighter-rouge">androidx.core.graphics.ColorUtils</code> in the <code class="language-plaintext highlighter-rouge">androidx.core</code> atifact. If you have been using other AndroidX libraries until now it‚Äôs highly possible that you already got this dependency transitively.</p>

<h3 id="color-luminance">Color luminance</h3>

<p>We are considering a <code class="language-plaintext highlighter-rouge">ColorInt</code> dark when the ‚Äúluminance‚Äù is lower than <code class="language-plaintext highlighter-rouge">0.5</code>. That‚Äôs not just an arbitrary number. Let‚Äôs learn what ‚Äúcolor luminance‚Äù means first, so we can understand the picked threshold.</p>

<blockquote>
  <p>Luminance is a measure to describe the perceived brightness of a color.</p>
</blockquote>

<p>Gotcha, it‚Äôs about how colors <strong>are perceived</strong>.</p>

<p>If you dive into <code class="language-plaintext highlighter-rouge">ColorUtils.calculateLuminance(colorInt)</code> you‚Äôll find it transforms the color into the <em>‚ÄúXYZ color space‚Äù</em> first to get the luminance.</p>

<p>The XYZ color space belongs to the category of <a href="https://en.wikipedia.org/wiki/CIE_1931_color_space">CIE 1931 color spaces</a>, which were created to reflect physiologically perceived colors in human color vision. The color theory is obviously quite more technical as you can see from the provided link. I‚Äôm not an expert in colors either, but given we‚Äôre interested in how colors are perceived by the human eye for this, this color space would be a perfect fit.</p>

<blockquote>
  <p>These color spaces are ‚Äúimportant when dealing with color inks, illuminated displays, and recording devices such as digital cameras‚Äù.</p>
</blockquote>

<blockquote>
  <p>‚ÄúThe CIE XYZ color space encompasses all color sensations that are visible to a person with average eyesight. That is why CIE XYZ (Tristimulus values) is a device-invariant representation of color.‚Äù</p>
</blockquote>

<p>That is significative for us, since we‚Äôd rather basing our calculations on how the color is perceived by the human eye under well-lit conditions, intentionally ignoring the massive device screen fragmentation out there.</p>

<p>In the XYZ color space, the second component (Y) represents relative luminance.</p>

<blockquote>
  <p>When judging the relative luminance (brightness) of different colors in well-lit situations, humans tend to perceive light within the green parts of the spectrum as brighter than red or blue light of equal power‚Ä¶ The CIE model capitalizes on this fact by setting Y as luminance.</p>
</blockquote>

<blockquote>
  <p>The unit of the tristimulus values X, Y, and Z is often arbitrarily chosen so that Y = 1 or Y = 100 is the brightest white that a color display supports.</p>
</blockquote>

<p>There you go. That‚Äôs why <code class="language-plaintext highlighter-rouge">0.5</code> (half of it when we represent it as a value between <code class="language-plaintext highlighter-rouge">0</code> and <code class="language-plaintext highlighter-rouge">1</code>) is the perfect threshold value.</p>

<p><strong>The closer Y gets to 1, the lighter the color is perceived by the human eye. The closer it gets to 0, the darker.</strong></p>

<p>As you can imagine <code class="language-plaintext highlighter-rouge">ColorUtils.calculateLuminance(colorInt)</code> relies on the <code class="language-plaintext highlighter-rouge">Y</code> component of the color, once it‚Äôs converted to the <code class="language-plaintext highlighter-rouge">XYZ</code> color space.</p>

<p>With this in mind, we can set the color for our icons and texts accordingly.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">color</span> <span class="p">=</span> <span class="nc">Color</span><span class="p">.</span><span class="nf">parseColor</span><span class="p">(</span><span class="s">"#e91e63"</span><span class="p">)</span>

<span class="k">if</span> <span class="p">(</span><span class="n">color</span><span class="p">.</span><span class="nf">isDark</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">colorHex</span><span class="p">.</span><span class="nf">setTextColor</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">color</span><span class="p">.</span><span class="n">white</span><span class="p">)</span>
    <span class="n">favIcon</span><span class="p">.</span><span class="nf">setImageResource</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">drawable</span><span class="p">.</span><span class="n">ic_favorite_border_white_24dp</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">colorHex</span><span class="p">.</span><span class="nf">setTextColor</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">color</span><span class="p">.</span><span class="n">black</span><span class="p">)</span>
    <span class="n">favIcon</span><span class="p">.</span><span class="nf">setImageResource</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">drawable</span><span class="p">.</span><span class="n">ic_favorite_border_black_24dp</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And we‚Äôre good to go üëç</p>

<h3 id="when-background-is-an-image">When background is an image</h3>

<p>We‚Äôve got a function to calculate luminance given a color, but what can we do when the background is an image?</p>

<p>Well we can steal <a href="https://github.com/android/plaid/blob/766093dfd8dfc11265c98c65fb2c3f5311a726cd/core/src/main/java/io/plaidapp/core/util/ColorUtils.java#L42">some color utilities from Plaid</a> for this. Thanks to <a href="https://twitter.com/crafty">@crafty</a> and the rest of the Google Android devs for sharing such an awesome sample project.</p>

<p>Let‚Äôs say we‚Äôve got this header this time. Look at these two variants:</p>

<div align="center">
  <img src="assets/images/contrasting_icon_detail_activity_dark.png" width="350px" style="float:left;" />
  <img src="assets/images/contrasting_icon_wrong_contrast.png" width="350px" style="float:left;margin-left:20px;" />
</div>

<p>You can see how the one with the dark fav icon works quite better for this background image. But this all depends on the image. E.g: A light icon would work better for this one:</p>

<div align="center">
  <img src="assets/images/contrasting_icon_detail_activity_light.png" width="350px" style="float:left;margin-left:20px;" />
</div>

<p>So again, we need a way to dynamically calculate the better contrasting color per image, given urls for those will often come from server, so we cannot know the images to be used beforehand.</p>

<p>Regardless of what async image loading library we use (<code class="language-plaintext highlighter-rouge">Picasso</code>, <code class="language-plaintext highlighter-rouge">Glide</code>, <code class="language-plaintext highlighter-rouge">Coil</code> or any others), there‚Äôs always ways to get dynamic access to the loaded <code class="language-plaintext highlighter-rouge">Drawable</code> / <code class="language-plaintext highlighter-rouge">Bitmap</code>. Libraries use to provide callbacks for this.</p>

<p>As soon as we get access to the loaded <code class="language-plaintext highlighter-rouge">Bitmap</code>, we can do the following:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">private</span> <span class="k">fun</span> <span class="nf">bindFavIcon</span><span class="p">(</span><span class="n">bitmap</span><span class="p">:</span> <span class="nc">Bitmap</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">iconSize</span> <span class="p">=</span> <span class="n">favIcon</span><span class="p">.</span><span class="n">width</span>

    <span class="nc">Palette</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="n">bitmap</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">maximumColorCount</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">clearFilters</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">setRegion</span><span class="p">(</span><span class="n">bitmap</span><span class="p">.</span><span class="n">width</span> <span class="p">-</span> <span class="n">iconSize</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">iconSize</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">generate</span> <span class="p">{</span> <span class="n">palette</span> <span class="p">-&gt;</span>
            <span class="c1">// Do something with the region palette.</span>
        <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We use <code class="language-plaintext highlighter-rouge">Palette</code> to extract the colors of the <code class="language-plaintext highlighter-rouge">Bitmap</code>, but just <strong>for a given region</strong>. Since our icon is aligned <code class="language-plaintext highlighter-rouge">top|end</code>, we‚Äôll only be interested in the top right image corner, not the rest, so we set the region accordingly.</p>

<p>Then we can call <code class="language-plaintext highlighter-rouge">val lightness = ColorUtils.isDark(palette)</code>. Note that we‚Äôre talking about the <a href="https://github.com/android/plaid/blob/766093dfd8dfc11265c98c65fb2c3f5311a726cd/core/src/main/java/io/plaidapp/core/util/ColorUtils.java#L72">Plaid ColorUtils</a> for this one. This is not included in the AndroidX ones.</p>

<p>This variant extracts the ‚Äúmost populous color‚Äù from the region palette, then it calls <code class="language-plaintext highlighter-rouge">isDark(color)</code> over it. But since <code class="language-plaintext highlighter-rouge">Palette</code> is not always able to calculate the mentioned color, there‚Äôs a chance that it returns <code class="language-plaintext highlighter-rouge">LIGHTNESS_UNKNOWN</code>.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">fun</span> <span class="nf">bindFavIcon</span><span class="p">(</span><span class="n">bitmap</span><span class="p">:</span> <span class="nc">Bitmap</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">iconSize</span> <span class="p">=</span> <span class="n">favIcon</span><span class="p">.</span><span class="n">width</span>

    <span class="nc">Palette</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="n">bitmap</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">maximumColorCount</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">clearFilters</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">setRegion</span><span class="p">(</span><span class="n">bitmap</span><span class="p">.</span><span class="n">width</span> <span class="p">-</span> <span class="n">iconSize</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">iconSize</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">generate</span> <span class="p">{</span> <span class="n">palette</span> <span class="p">-&gt;</span>
            <span class="kd">val</span> <span class="py">lightness</span> <span class="p">=</span> <span class="nc">ColorUtils</span><span class="p">.</span><span class="nf">isDark</span><span class="p">(</span><span class="n">palette</span><span class="p">)</span> <span class="c1">// might be unknown!</span>
            <span class="kd">val</span> <span class="py">isDark</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">lightness</span> <span class="p">==</span> <span class="nc">ColorUtils</span><span class="p">.</span><span class="nc">LIGHTNESS_UNKNOWN</span><span class="p">)</span> <span class="p">{</span>
                <span class="o">..</span><span class="p">.</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">lightness</span> <span class="p">==</span> <span class="nc">ColorUtils</span><span class="p">.</span><span class="nc">IS_DARK</span>
            <span class="p">}</span>
        <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In that case we need a second fallback. We can rely on another variant: <code class="language-plaintext highlighter-rouge">ColorUtils.isDark(bitmap, bitmap.width - iconSize / 2, iconSize / 2)</code>.</p>

<p>This one determines if a given <code class="language-plaintext highlighter-rouge">Bitmap</code> is dark, and if it‚Äôs not able to, it has a third fallback to the color of the given pixel (<code class="language-plaintext highlighter-rouge">x</code>, <code class="language-plaintext highlighter-rouge">y</code>) provided as second and third arguments in the call. We can pass the full <code class="language-plaintext highlighter-rouge">Bitmap</code> (not just the region) for it and see whether we have more luck.</p>

<p>This is how the complete code snippet would look like:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Palette</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="n">bitmap</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">maximumColorCount</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">clearFilters</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">setRegion</span><span class="p">(</span><span class="n">bitmap</span><span class="p">.</span><span class="n">width</span> <span class="p">-</span> <span class="n">iconSize</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">iconSize</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">generate</span> <span class="p">{</span> <span class="n">palette</span> <span class="p">-&gt;</span>
        <span class="kd">val</span> <span class="py">lightness</span> <span class="p">=</span> <span class="nc">ColorUtils</span><span class="p">.</span><span class="nf">isDark</span><span class="p">(</span><span class="n">palette</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">isDark</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">lightness</span> <span class="p">==</span> <span class="nc">ColorUtils</span><span class="p">.</span><span class="nc">LIGHTNESS_UNKNOWN</span><span class="p">)</span> <span class="p">{</span>
            <span class="nc">ColorUtils</span><span class="p">.</span><span class="nf">isDark</span><span class="p">(</span><span class="n">bitmap</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">.</span><span class="n">width</span> <span class="p">-</span> <span class="n">iconSize</span> <span class="p">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">iconSize</span> <span class="p">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">lightness</span> <span class="p">==</span> <span class="nc">ColorUtils</span><span class="p">.</span><span class="nc">IS_DARK</span>
        <span class="p">}</span>


        <span class="k">if</span> <span class="p">(</span><span class="n">isDark</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// make back icon dark on light images</span>
            <span class="n">favIcon</span><span class="p">.</span><span class="nf">setImageResource</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">drawable</span><span class="p">.</span><span class="n">ic_favorite_border_white_24dp</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">favIcon</span><span class="p">.</span><span class="nf">setImageResource</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">drawable</span><span class="p">.</span><span class="n">ic_favorite_border_black_24dp</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Of course the third fallback (pixel color) is not great, since surrounding pixels close to it might not have similar colors, but it‚Äôs very unlikely that it gets called and I guess it‚Äôs better than nothing.</p>

<p>And with this, you‚Äôd get your solution ready to work with dynamic images üëå</p>

<h3 id="final-words">Final words</h3>

<p>So often designs are a bit naive on dynamic content, but you noticed how content directly affects the user experience. It‚Äôs our responsibility to ask the design team what should we do under the mentioned scenarios, so we can make them be aware of the problem in the first place. The ultimate goal is that both teams can work together to achieve an optimal result.</p>

<p>If you are interested in Android, I share thoughts and ideas <a href="https://twitter.com/JorgeCastilloPR">on Twitter</a>, quite regularly. You can also find me <a href="https://www.instagram.com/jorgecastillopr/">on Instagram</a>. Please feel free to follow.</p>

<p>See you around üëãüé®</p>

<h3 id="want-to-support-me">Want to support me?</h3>

<p>If you reached this point you might consider supporting me for boosting my will to write. If that‚Äôs the case, here you have a button, really appreciated! ü§ó</p>

<p>Supported or not, I will keep writing and providing content for free ‚úÖ</p>

<p><a href="https://www.buymeacoffee.com/jorgecastillo" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/default-orange.png" alt="Buy Me A Coffee" style="height: 51px !important;width: 217px !important;" /></a></p>

                </div>
            </section>

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/images/avatar.jpeg" alt="jorge" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/jorge">Jorge Castillo</a></h4>
                                
                                    <p>Android developer, Arrow maintainer, pianist wannabe üéπ</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/jorge">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                  <div id="disqus_thread"></div>
                  <script>

                  /**
                  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

                  var disqus_config = function () {
                      this.page.url = 'https://jorgecastilloprz.github.io/contrasting-text-and-icons-over-background';
                      this.page.identifier = 'https://jorgecastilloprz.github.io/contrasting-text-and-icons-over-background';
                  };

                  (function() { // DON'T EDIT BELOW THIS LINE
                    var d = document, s = d.createElement('script');
                    s.src = 'https://jorgecastilloblog.disqus.com/embed.js';
                    s.setAttribute('data-timestamp', +new Date());
                    (d.head || d.body).appendChild(s);
                  })();
                  </script>
                  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/images/blog-cover-dark.png)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; üë®‚Äçüíª Jorge Castillo &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/android/">Android</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/composed-modifiers-in-jetpack-compose">Composed modifiers in Jetpack Compose</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/jetpack-compose-withconstraints">Custom Layouts, measuring policies, and BoxWithConstraints in Jetpack Compose</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/jetpack-compose-effect-handlers">Jetpack Compose Effect Handlers</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/android/">
                                
                                    See all 10 posts  ‚Üí
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/online-courses-tips">
                <div class="post-card-image" style="background-image: url(/assets/images/onlinecourses.jpeg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/online-courses-tips">
                <header class="post-card-header">
                    
                        
                            
                               <span class="post-card-tags">Trainings</span>
                            
                        
                            
                                <span class="post-card-tags">Education</span>
                            
                        
                    

                    <h2 class="post-card-title">Tips for productive online courses</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/avatar.jpeg" alt="Jorge Castillo" />
                        
                        <span class="post-card-author">
                            <a href="/author/jorge/">Jorge Castillo</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/theming-your-custom-views-through-the-context">
                <div class="post-card-image" style="background-image: url(/assets/images/painting6.jpeg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/theming-your-custom-views-through-the-context">
                <header class="post-card-header">
                    
                        
                            
                               <span class="post-card-tags">Android</span>
                            
                        
                            
                                <span class="post-card-tags">Kotlin</span>
                            
                        
                    

                    <h2 class="post-card-title">Putting view theming into Context</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/avatar.jpeg" alt="Jorge Castillo" />
                        
                        <span class="post-card-author">
                            <a href="/author/jorge/">Jorge Castillo</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://jorgecastilloprz.github.io/">
            
            <span>üë®‚Äçüíª Jorge Castillo</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Contrasting text and icons over background</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Contrasting+text+and+icons+over+background&amp;url=https://jorgecastilloprz.github.io/contrasting-text-and-icons-over-background"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://jorgecastilloprz.github.io/contrasting-text-and-icons-over-background"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://jorgecastilloprz.github.io/">üë®‚Äçüíª Jorge Castillo</a> &copy; 2025</section>
                <section class="poweredby">
                    <a rel="me" href="https://androiddev.social/@jorge">Mastodon</a>
                </section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    <a href="https://twitter.com/jorgecastillopr" target="_blank" rel="noopener">Twitter</a>
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-142413286-1', 'auto');
  ga('send', 'pageview');

 </script>

<!-- 100% privacy-first analytics -->
<script async src="https://scripts.simpleanalyticscdn.com/latest.js"></script>


    <script defer data-domain="jorgecastillo.dev" src="https://plausible.io/js/script.js"></script>

    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
